import Express from"../express.mjs";import{Module}from"../../packages/_module.mjs";import{getRoute}from"../../../common/utils/_module.mjs";export default class View{route;socket=!1;_template;_methods=[];get hasGet(){return this._methods.includes("get")}get hasPost(){return this._methods.includes("post")}async handleGet(e,s){}async handlePost(e,s){}async handleSocket(e,s){}_noWorld(e,s){return View.error(e,s,{pageTitle:"No Active Game",message:"There is currently no active game session. Please wait for the host to configure the world and then refresh this page."})}static assertDocumentDestination(e,s=["document","empty"]){if(e.headers["sec-fetch-dest"]&&!s.includes(e.headers["sec-fetch-dest"]))throw new Error(`The ${e.originalUrl} route does not accept this type of request`)}static error(e,s,...t){const r=t.pop()||global.fatalError,o=this._getStaticContent({setup:!0});s.render("error",{layout:"setup",bodyClass:["auth","error","flexcol",`theme-${config.options.cssTheme}`].join(" "),pageTitle:r.title||"Critical Failure!",message:r.message||"Something went wrong with the Foundry Virtual Tabletop server.",setupUrl:getRoute("setup",{prefix:express.routePrefix}),stack:r.stack||null,styles:o.styles})}static home(e,s){const{config:t,game:r}=global,o={prefix:express.routePrefix};return t.license.needsSignature?s.redirect(getRoute("license",o)):r.world?e.user?s.redirect(getRoute("game",o)):s.redirect(getRoute("join",o)):s.redirect(getRoute("setup",o))}static _getStaticContent({world:e=!1,setup:s=!1,moduleConfig:t={}}){const r=[],o=[],i=new Set,c=(e,s,t,c)=>{const l="style"===s?o:r;i.has(e)||l.push({src:e,type:s,priority:t,layer:c,isModule:"module"===s})},l=0,a=1,u=2,n=3,m=4,d=5,p=6,h=7,y=8,f=9,g=10,E=0,_=1,w=2,x=3,S=4;if(Express.CORE_VIEW_SCRIPTS.forEach((e=>c(e,"script",l))),e&&c("scripts/simplepeer.min.js","script",l),Express.CORE_VIEW_MODULES.forEach((e=>c(e,"module",a))),Express.CORE_VIEW_STYLES.forEach((e=>c(e.src,"style",_,e.layer))),e){const e=global.game.world;e.system.esmodules.forEach((e=>c(e,"module",p))),e.system.scripts.forEach((e=>c(e,"script",d))),e.system.styles.forEach((({src:e,layer:s})=>{c(e,"style",w,void 0===s?"system":s)}));for(const s of e.modules){if(!0!==t[s.id])continue;const e=s.library??!1;s.esmodules.forEach((s=>c(s,"module",e?m:y))),s.scripts.forEach((s=>c(s,"script",e?n:h))),s.styles.forEach((({src:s,layer:t})=>{c(s,"style",e?E:x,void 0===t?"modules":t)}))}e.esmodules.forEach((e=>c(e,"module",g))),e.scripts.forEach((e=>c(e,"script",f))),e.styles.forEach((({src:e,layer:s})=>c(e,"style",S,s)))}if(c("scripts/vendor.mjs","module",u),c("scripts/foundry.mjs","module",u),s){Module.getCoreTranslationStyles().forEach((e=>{c(e.src,"style",e.library?E:x,"modules")}))}const C=(e,s)=>e.priority-s.priority;return r.sort(C),o.sort(C),{scripts:r,styles:o.reduce(((e,s)=>(s.priority===w?e.system.push(s):s.priority===x?e.modules.push(s):e.core.push(s),e)),{core:[],system:[],modules:[]})}}}